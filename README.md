# Рекомендация банковских продуктов

Финальный проект курса ML Engineering (Yandex Practicum).

**Цель:** предсказать, какие банковские продукты (кредиты, депозиты, карты, инвестиционные инструменты) клиент приобретёт в следующем месяце, на основе данных о его поведении за 1.5 года.

**Технологии:** Python, scikit-learn, LightGBM/CatBoost, MLflow, FastAPI, Docker, Prometheus.

---

## Структура проекта

```
final_project_bank/
│
├── README.md                    # Документация проекта (этот файл)
├── requirements.txt             # Зависимости Python (фиксированные версии)
├── .gitignore                   # Игнорируемые файлы (.csv, .cache и др.)
│
├── train_ver2.csv               # Датасет (~2.1 ГБ, ~13.6 млн строк, 48 колонок)
│                                  Не входит в репозиторий (.gitignore)
│
├── notebooks/                   # Jupyter-ноутбуки
│   ├── eda.ipynb                #   EDA — исследовательский анализ данных
│   └── modeling.ipynb           #   Эксперименты, пайплайн, обучение модели
│
├── models/                      # Артефакты моделей
│   └── model.bin                #   Сериализованная финальная модель (.bin)
│
├── scripts/                     # Shell-скрипты
│   └── start_mlflow.sh          #   Запуск и настройка MLflow
│
├── service/                     # Веб-сервис (API)
│   ├── app.py                   #   FastAPI-приложение
│   ├── predict.py               #   Логика инференса
│   └── Dockerfile               #   Docker-образ сервиса
│
└── monitoring/                  # Мониторинг
    └── MONITORING.md            #   Описание метрик и алертов
```

**Форматы файлов:**
- `.ipynb` — Jupyter-ноутбуки (EDA, моделирование)
- `.bin` — сериализованная модель (pickle/joblib)
- `.sh` — shell-скрипты для запуска инфраструктуры
- `.py` — Python-код сервиса
- `.csv` — данные (не включены в репозиторий, загружаются отдельно)

---

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone https://github.com/GReddyD/final_project_bank.git
cd final_project_bank
```

### 2. Создание окружения и установка зависимостей

```bash
python -m venv venv
source venv/bin/activate          # macOS/Linux
pip install -r requirements.txt
```

### 3. Загрузка данных

Положите файл `train_ver2.csv` в корень проекта. Файл не входит в репозиторий из-за размера (~2.1 ГБ).

### 4. Запуск MLflow

```bash
bash scripts/start_mlflow.sh
```

### 5. Запуск ноутбуков

```bash
jupyter notebook notebooks/eda.ipynb
jupyter notebook notebooks/modeling.ipynb
```

### 6. Запуск сервиса

```bash
cd service
docker build -t bank-recommender .
docker run -p 8000:8000 bank-recommender
```

---

## Руководство по проекту

### 1. Трансляция бизнес-задачи в техническую

**Бизнес-задача:** определить, какие банковские продукты предложить конкретному клиенту, чтобы повысить перекрёстные продажи и снизить риски.

**Техническая задача:** multi-label классификация — для каждого клиента предсказать вероятность подключения каждого из 24 банковских продуктов в следующем месяце. Целевая переменная — переход продукта из состояния 0 (нет) в 1 (есть).

**Метрики качества:**

*TODO: заполнить после выбора метрик. Возможные варианты:*
- *MAP@K — средняя точность в top-K рекомендациях*
- *F1 micro/macro — баланс точности и полноты по всем продуктам*
- *AUC-ROC per product — качество ранжирования по каждому продукту*

### 2. Разворачивание инфраструктуры обучения модели

Для логирования экспериментов используется **MLflow**. Запуск инфраструктуры:

```bash
bash scripts/start_mlflow.sh
```

Скрипт выполняет:
- Запуск MLflow Tracking Server
- Настройку хранилища артефактов
- Вывод URI для подключения из ноутбуков

*TODO: дополнить после реализации*

### 3. Проведение EDA

Ноутбук: `notebooks/eda.ipynb`

Ключевые шаги:

*TODO: заполнить после проведения EDA. Ожидаемые блоки:*
- *Общая статистика датасета (размер, типы, пропуски)*
- *Распределения клиентских признаков (возраст, доход, сегмент, стаж)*
- *Анализ пропусков и стратегия заполнения*
- *Популярность продуктов и динамика подключений по месяцам*
- *Корреляции между продуктами и признаками*
- *Основные выводы и закономерности*

### 4. Генерация признаков и обучение модели

Ноутбук: `notebooks/modeling.ipynb`

*TODO: заполнить после моделирования. Ожидаемые блоки:*
- *Описание сгенерированных признаков (лаги, агрегаты, тренды)*
- *Влияние признаков на качество модели*
- *Сравнение экспериментов в MLflow (baseline vs. финальная модель)*
- *Финальная модель и её метрики*

### 5. Разворачивание инфраструктуры применения модели

Сервис развёрнут через Docker:

```bash
cd service
docker build -t bank-recommender .
docker run -p 8000:8000 bank-recommender
```

*TODO: дополнить после реализации. Ожидаемые блоки:*
- *Описание API-эндпоинтов*
- *Формат запросов и ответов*
- *Описание мониторинга (monitoring/MONITORING.md)*
- *Стратегия дообучения модели*

---

## Описание данных

Файл `train_ver2.csv` — данные о поведении клиентов банка с 28 января 2015 по июнь 2016. Ежемесячные записи: одна строка = один клиент в одном месяце.

### Признаки клиента (колонки 1–24)

| Колонка | Описание |
|---------|----------|
| `fecha_dato` | Дата записи (ежемесячные срезы) |
| `ncodpers` | ID клиента |
| `ind_empleado` | Статус занятости (A/B/F/N/S) |
| `pais_residencia` | Страна резидентства |
| `sexo` | Пол (H — мужской, V — женский) |
| `age` | Возраст |
| `fecha_alta` | Дата первого контракта с банком |
| `ind_nuevo` | Новый клиент, зарегистрирован < 6 мес. (1/0) |
| `antiguedad` | Стаж клиента в банке (мес.) |
| `indrel` | Тип: 1 — первичный, 99 — первичный в течение месяца |
| `ult_fec_cli_1t` | Последняя дата премиального статуса |
| `indrel_1mes` | Тип в начале месяца: 1=премиальный, 2=собственник, P=потенциальный |
| `tiprel_1mes` | Отношения: A=активный, I=неактивный, P=бывший, R=потенциальный |
| `indresi` | Резидент страны банка (S/N) |
| `indext` | Страна рождения отличается от страны банка (S/N) |
| `conyuemp` | Супруг(а) сотрудника банка (S/N) |
| `canal_entrada` | Канал привлечения клиента |
| `indfall` | Индекс актуальности счёта (N/S) |
| `tipodom` | Тип адреса (1 — основной) |
| `cod_prov` | Код провинции |
| `nomprov` | Название провинции |
| `ind_actividad_cliente` | Активность (1 — активный, 0 — нет) |
| `renta` | Доход домохозяйства |
| `segmento` | Сегмент: 01=VIP, 02=Обычные, 03=Выпускники |

### Банковские продукты (колонки 25–48, целевые переменные)

| Колонка | Продукт |
|---------|---------|
| `ind_ahor_fin_ult1` | Сберегательный счёт |
| `ind_aval_fin_ult1` | Банковская гарантия |
| `ind_cco_fin_ult1` | Текущие счета |
| `ind_cder_fin_ult1` | Деривативный счёт |
| `ind_cno_fin_ult1` | Зарплатный проект |
| `ind_ctju_fin_ult1` | Детский счёт |
| `ind_ctma_fin_ult1` | Особый счёт 3 |
| `ind_ctop_fin_ult1` | Особый счёт |
| `ind_ctpp_fin_ult1` | Особый счёт 2 |
| `ind_deco_fin_ult1` | Краткосрочный депозит |
| `ind_deme_fin_ult1` | Среднесрочный депозит |
| `ind_dela_fin_ult1` | Долгосрочный депозит |
| `ind_ecue_fin_ult1` | Цифровой счёт |
| `ind_fond_fin_ult1` | Денежные средства |
| `ind_hip_fin_ult1` | Ипотека |
| `ind_plan_fin_ult1` | Пенсионный план |
| `ind_pres_fin_ult1` | Кредит |
| `ind_reca_fin_ult1` | Налоговый счёт |
| `ind_tjcr_fin_ult1` | Кредитная карта |
| `ind_valo_fin_ult1` | Ценные бумаги |
| `ind_viv_fin_ult1` | Домашний счёт |
| `ind_nomina_ult1` | Зарплатный аккаунт |
| `ind_nom_pens_ult1` | Пенсионный аккаунт |
| `ind_recibo_ult1` | Дебетовый аккаунт |

---

## Воспроизводимость

- `random_state=42` во всех стохастических операциях
- Все эксперименты логируются в MLflow
- Зависимости зафиксированы в `requirements.txt` с точными версиями
